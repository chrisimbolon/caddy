{
    email sambungdata@gmail.com  #  for Let's Encrypt SSL
}

# Serve portfolio site
chrisimbolon.dev {
    reverse_proxy portfolio-container:80

    @noSlash path /planetwander
    redir @noSlash /planetwander/

    handle_path /planetwander/* {
        reverse_proxy planetwander_frontend:80
    }

    handle_path /api/* {
        reverse_proxy planetwander_backend:8000
    }

    handle_path /fullstack-pizza/* {
        root * /home/apps/fullstack-pizza
        file_server
    }   

    redir /fullstack-pizza /fullstack-pizza/

    handle /mini-analytics/api/* {
        reverse_proxy analytics-backend:8000
    }

    handle_path /mini-analytics/* {
        reverse_proxy analytics-frontend:80
    }

}

randomdots.id {
    reverse_proxy randomdots-app:3000
}

taekwondo-coach.chrisimbolon.dev {
    reverse_proxy djangotaekwondocoach-nginx:80
}

eventhub.chrisimbolon.dev {
    handle /api/* {
        reverse_proxy eventhub_backend:8000
    }

     # Django static files (admin CSS, JS, etc.)
    handle /static/* {
        root * /var/www/eventhub-backend
        file_server
        encode gzip
    }
    
    # Django media files (uploads, QR codes, etc.)
    handle /media/* {
        root * /var/www/eventhub-backend
        file_server
    }
    
    handle {
        root * /var/www/eventhub
        try_files {path} /index.html
        file_server
        encode gzip
        
        @static {
            path *.js *.css *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2
        }
        header @static Cache-Control "public, max-age=31536000, immutable"
    }
}